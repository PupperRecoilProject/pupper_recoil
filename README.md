### Pupper Robot - 完整指令參考手冊 (v2.0)

**語法說明:**
*   `<param>`: 表示此為一個**必須**替換的參數。
*   `[param]`: 表示此為一個**可選**的參數。
*   `|`: 表示「或」，用於分隔可選的關鍵字。 例如 `on|off` 表示可填 `on` 或 `off`。
*   所有指令輸入後需按 `Enter` 鍵執行。

---
#### **1. 核心控制 (Core Control)**
*這些是控制機器人基本姿態和動作的最高級指令。*

`stand`
:   讓機器人進入穩定的標準站立姿態。此指令使用級聯控制器以獲得平滑、穩定的效果。

`pos <id> <rad>`
:   平滑地移動**單一**馬達到指定角度（單位：弧度）。
:   *範例: `pos 2 -2.5`*

`group <type> <rad>`
:   平滑地移動一**組**功能相同的關節到指定角度。
:   *`<type>`: `hip` (髖關節), `upper` (大腿), `lower` (小腿)*
:   *範例: `group upper 1.57` (將所有大腿關節設定為 1.57 rad)*

`stop`
:   **(安全指令)** 立即停止所有馬達運動，釋放力矩，並進入 IDLE 待機模式。所有控制器狀態將被重置。

---
#### **2. 系統與校準 (System & Calibration)**
*管理系統狀態和校準的基礎指令。*

`cal`
:   執行手動校準程序。**必須在 IDLE 模式下操作**。請先手動將機器人擺放至預設校準姿態，再執行此指令。

`reboot`
:   重新啟動微控制器。

---
#### **3. 參數調校 (Parameter Tuning) - [全新設計]**
*動態調整級聯控制器參數，無需重新編譯。*

`set_param <scope> <param_name> <value>`
:   設定一個特定的控制器參數。這是最強大的調參指令。
:   **`<scope>`**:
    :   `global` - 設定全域預設值。
    :   `motor <id>` - 只設定指定 ID 的馬達。
    :   `group <name>` - 設定一個預定義的組。
:   **`<group_name>`**:
    :   功能組: `hip`, `upper`, `lower`
    :   結構組: `leg0`, `leg1`, `leg2`, `leg3`, `leg_front`, `leg_rear`
:   **`<param_name>`**:
    :   `pos_kp` - 位置環 P 增益
    :   `vel_kp` - 速度環 P 增益
    :   `vel_ki` - 速度環 I 增益
    :   `max_vel` - 最大目標速度 (rad/s)
    :   `max_int` - 速度環積分飽和上限
:   *範例 1: `set_param global pos_kp 16.0` (設定全域 pos_kp)*
:   *範例 2: `set_param motor 3 vel_kp 650.0` (單獨調高 3 號馬達的 vel_kp)*
:   *範例 3: `set_param group leg0 max_vel 6.5` (降低 0 號腿的速度限制)*

`reset_param <scope>`
:   將指定範圍的參數重置。
:   **`<scope>`**:
    :   `motor <id>` - 將指定馬達的參數重置為**當前全域值**。
    :   `group <name>` - 將指定組內所有馬達的參數重置為**當前全域值**。
    :   `global` - 將全域參數重置為**系統編譯時的預設值**。
    :   `all` - **(完全重置)** 將所有馬達和全域參數都重置為**系統編譯時的預設值**。
:   *範例 1: `reset_param motor 3` (撤銷對 3 號馬達的單獨修改)*
:   *範例 2: `reset_param all` (恢復到程式剛燒錄時的狀態)*

`get_param [scope]`
:   查詢並打印當前的控制器參數。
:   **`[scope]`**:
    :   若**不提供 scope**，則打印**全域**參數。
    :   `motor <id>` - 打印指定馬達**當前生效**的參數。
    :   `group <name>` - 打印組內所有馬達的參數。
    :   `all` - 詳細列出**所有12個馬達**的參數，並用 `(*)` 標示出被單獨修改過的值。
:   *範例 1: `get_param` (查看全域設定)*
:   *範例 2: `get_param motor 3`*
:   *範例 3: `get_param all` (全面檢查狀態)*

---
#### **4. 監控與除錯 (Monitoring & Debugging)**
*控制序列埠輸出的格式和內容。*

`monitor <mode>`
:   設定監控數據的輸出格式。
:   *`<mode>`: `human` (人類可讀), `csv` (逗號分隔值), `dashboard` (儀表板格式)*

`freq <hz>`
:   設定監控數據的打印頻率（單位：赫茲）。
:   *範例: `freq 10` (每秒打印 10 次)*

`focus <id | off>`
:   在所有監控模式中，特別聚焦於某個馬達的詳細數據。
:   *範例 1: `focus 3`*
:   *範例 2: `focus off` (關閉聚焦)*

`print <on | off>`
:   [舊版] 啟用/禁用在 `human` 模式下打印額外的電流和扭矩數據。

---
#### **5. 底層測試 (Low-Level Testing)**
*用於硬體測試或特定控制器比較的低階指令。*

`raw <id> <mA>`
:   直接設定單一馬達的原始電流（單位：毫安），繞過所有控制器。**請謹慎使用**。
:   *範例: `raw 0 500`*

`test_wiggle <id>`
:   對指定馬達啟動一個正弦波擺動測試。

`test_pid <id> <rad>`
:   [舊版] 使用舊的單環 PID 控制器來設定馬達位置，用於性能比較。

---

### 指令設計思考與說明

1.  **`set_param`, `reset_param`, `get_param` 的統一性**：
    我將所有參數操作統一到這三個動詞下。使用者只需要記住這三個詞，然後根據需求組合 `scope` 和 `param_name`。這種設計模式（類似 RESTful API）非常直觀且易於學習。

2.  **`scope` 的強大能力**：
    `scope` 的概念是這次設計的核心。它允許使用者從最宏觀的 `global` 到最微觀的 `motor <id>` 進行操作。特別是 `group` 的引入，極大地提升了調參效率。您可以一次性調整所有腿的 `hip` 關節，或者調整整條 `leg0` 的參數，這非常符合四足機器人的調試邏輯。

3.  **清晰的重置邏輯 (`reset_param`)**：
    我明確區分了兩種重置：
    *   **重置為全域**：這是一種「撤銷」操作，讓某個馬達不再特殊，回歸大部隊。
    *   **重置為系統預設**：這是一種「恢復出廠設定」，當您把參數調亂時，可以快速回到一個已知的、安全的狀態。

4.  **強大的狀態查詢 (`get_param`)**：
    `get_param all` 加上 `(*)` 標記，是除錯的利器。當您感覺某個馬達行為怪異時，執行此指令，可以一目了然地看到是不是因為對它設定了錯誤的自訂參數。

5.  **分區塊的易讀性**：
    在指令表中，我將指令分為「核心控制」、「系統」、「調參」、「監控」、「底層」五大類。當您想做某件事時，可以快速定位到對應的區塊，而不用在一長串無序的列表中尋找。例如，所有調參相關的功能都集中在第 3 區塊。

我覺得這份指令表既能滿足您提出的所有需求，又具備了良好的結構和前瞻性。它將成為您後續開發和調試機器人時非常有力的助手。

接下來，我們就可以根據這份設計藍圖，開始著手修改程式碼了。您對這份指令設計滿意嗎？有沒有需要調整或補充的地方？